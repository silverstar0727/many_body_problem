프로젝트의 내용은 크게 두 골자로 나뉜다. 첫째는 삼체문제이며, 둘째는 다체문제이다(여기서 ‘다체’는 물체 각각의 상태가 아닌 전체 계의 상태에 대해 관심있을 만큼 많은 물체를 의미한다). 또한, 본 프로젝트에서 사용한 환경은 i7 8thgen processor, RTX2060, win10, python3.8이고, 모든 시뮬레이션 영상은 QR코드로 확인할 수 있다.

우선 삼체문제에서는 3개 물체의 위치와 속도를 모두 알아야 하므로 총 18개의 방정식이 존재한다. 여기서 질량중심을 이용하여 6개의 적분을 도출할 수 있고, 각운동량을 통해 3개, 에너지 보존법칙을 통해 1개로 총 10개의 적분을 고전적인 방법으로 도출할 수 있다. 추가로 시간과 교점의 제거를 통해 적분상수 2개가 나와 총 12개의 적분만이 가능하다. 18개의 방정식에서 12개만이 도출할 수 있으므로 우리는 이체문제처럼 궤도가 특정 함수의 형태일 것이라고 예측할 수 없음을 알았다.

따라서, 이번 시뮬레이션은 초기조건이 주어졌을 때, 임의의 시간에서 물체의 운동상태를 수치적 방법으로 도출을 시도하였다. 유의미한 상황으로 특정하는 것이 적합하다고 생각하였고, 태양-지구-목성의 삼체문제로 특정하였다. 이때, 목성에 의한 지구의 섭동을 더욱 역동적으로 표현할 필요가 있었으므로 목성의 질량을 기존보다 515배 큰 값으로 설정하였다. 초기위치는 알려진 바와 동일한 태양으로부터의 거리로 설정하였으며, 초기 속도 또한, 태양에서의 시선속도와 수직인 방향과 알려진 크기로 설정하였다. 삼체문제와 같은 복잡계 역학의 경우에는 초기조건의 영향을 많이 받아서 설정값을 수차례 바꾸어가며 안정된 궤도와 유의미한 결과값의 양립에 심혈을 기울였다.

흔히 알려진 뉴턴역학의 식 (1)의 특정 step에서 각 물체가 받는 힘을 알고 있으므로 가속도에 대한 식을 구할 수 있다. 가속도는 변위에 대한 이계도함수이고, 힘의 크기는 변위에 대한 함수이므로 결과적으로는 2계 상미분방정식을 풀어야 했다. 일반적으로 수치해석에서 2계 상미분방정식은 두 개의 1계 연립상미분방정식으로 치환하여 해결하는데, 식 (2)와 식 (3)의 연립이 그것이다. 

수치적 방법으로는 전진 오일러 방법이나, 단계적 방법 등 다양한 방법이 존재한다는 것을 공부를 통해 알게 되었으나, 통념상 4차의 Runge-Kutta method가 가장 예측과 일치하며 시간복잡도가 낮은 편에 속하기에 해당 방법을 사용하였다. 4차의 Runge-Kutta method에서는 4개의 보조인자가 활용되고, 이들은 각각 식 (4) ~ 식 (7)에 해당한다. 따라서 스텝별 모든 물체의 위치와 속도의 변화를 지속적으로 업데이트할 수 있도록 프로그래밍하였다. 여기서 시뮬레이션은 시각화 라이브러리인 matplotlib의 animation을 사용하였고, 저장을 위해 ffmpeg코덱을 anaconda terminal에서 설치했다.

다음으로 다체문제의 경우에는 은하를 가정하여 5~7만개 가량의 물체를 시뮬레이션하였다. 다체문제의 시간복잡도는 brute force 알고리즘을 적용할 시 으로 상당히 많은 계산량을 요구하기에 barnes-hut 알고리즘과 GPU를 활용한 CUDA 가속을 통해 프로그래밍하였다. barnes-hut 알고리즘은 다체문제에서의 시간복잡도를 수준으로 낮추어 준다. 이는 한 공간에 하나의 물체가 들어오도록 공간을 4분할 하여 계산해야 하는 물체의 개수를 작은 단위로 나누는 방식을 사용하기 때문이다. <그림 1>은 알고리즘을 도식화한 것이며, 여기서도 각 공간 안에 한 개의 물체가 존재하는 것을 알 수 있다. 그러나 시간복잡도를 낮추어 주는 만큼 결과의 오차가 커질 수 있다는 단점도 존재한다.

CUDA(Computed Unified Device Architecture)란, NVIDIA에서 개발한 GPU툴이다. CPU와 비교하면 CPU는 단지 몇 개의 core를 가지고 있지만, GPU는 수천 개의 core를 가지고 있어 core당 연산속도가 느려도 전체적인 데이터 연산량은 GPU가 월등히 높다. 이번 프로젝트에서는 CUDA 가속을 사용하기 위해 python의 numba 라이브러리를 이용하였다. CUDA의 데이터 아키텍처는 thread-block-grid의 계층적 구조를 지니고 있는데, host의 kernel에서 device의 grid를 실행시키는 방식으로 작동한다. 이번 프로젝트에서는 grid를 2차원으로 구성하여 진행했다.

다체문제에서도 삼체문제와 마찬가지로 수치적 방법으로 4차의 Runge-Kutta method를 사용하였다. 초기조건의 경우에는 실제와 최대한 유사하도록 설정하였다. 우선 초기위치는 은하의 중심으로부터 2차원을 가정하고, 극 좌표계에서 거리와 각도를 난수로 생성하였다. 이는 원반 모양의 은하 형태를 구현하기 위함이었으며, z 값은 상대적으로 아주 작은 값의 난수로 설정하였다. 이때, 보이는 물질의 질량 분포가 은하의 중심에 집중되어 있다는 사실을 참고하여 중심으로부터의 거리와 물체 분포를 반비례하도록 설정하였다. 초기 속도는 은하의 중심으로부터의 시선속도와 수직한 방향과 모든 물체에 대해 같은 값으로 크기를 특정하였다. 

추가로 다체문제에서는 특이점에 대해 고려해야 했는데, 중력은 서로 잡아당기는 방향으로 작용하므로, 물체 간의 거리가 0으로 수렴할 수 있기 때문이다. 실제로는 거리가 0에 가까워질 때 중력보다 조석력의 크기가 커지는 등 다양한 물리적 작용을 하지만, 컴퓨팅에서의 관심사는 중력이 거리에 반비례하므로 zero division error를 비롯하여 계산량이 급격히 증가한다는 것이다. 이러한 특이점은 2차원에서 복소수를 이용한 좌표변환의 Levi-Civita 방법과 이것의 확장 격인 Kustaanheimo-Stiefel 방법의 정칙화가 존재한다. 그러나, 근접계가 2체를 넘는 경우 정칙화가 불가능하다는 것, 시간복잡도가 증가한다는 등의 단점이 존재한다. 따라서 이번 프로젝트에서는 위치의 업데이트 시 일정 거리 이상으로 가까워질 때, 특정 값으로 거리를 정하는 것으로 정칙화를 갈음하였다.
